class e{symbol;constructor(e){this.symbol=e}get symbol(){return this.symbol}}class t extends e{getMove(e){return 7}}const r=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];class s{board;constructor(){this.board=this.getBlank()}get board(){return this.board}addMove(e,t){this.abortInvalidMove(t),this.board[t]=e.symbol}getWinner(){for(let e=0,t=r.length;e<t;e++){let t=r[e];if(null!==this.board[t[0]]&&this.board[t[0]]===this.board[t[1]]&&this.board[t[0]]===this.board[t[2]])return this.board[t[0]]}return null}abortInvalidMove(e){if(0>e||e>8)throw new Error("Index is not between 0 and 8.");if(null!==this.board[e])throw new Error("This field is already taken.")}getBlank(){let e=[];for(let t=0,r=9;t<r;t++)e[t]=null;return e}}const i="game-restart",a="game-overlay",n="game-message",l="game-error",o="game-board",h="invisible",u="visible",m="success",d="failure",c={win:"You've won!",loose:"You've lost!",tie:"It's a tie!"};class y{restart;overlay;message;error;board;current_player;winner;computer;human;state;constructor(){if(this.overlay=document.getElementById(a),this.restart=document.getElementById(i),this.message=document.getElementById(n),this.error=document.getElementById(l),this.board=document.getElementById(o),null===this.error||null===this.restart||null===this.board||null===this.overlay||null===this.message)throw new Error("Could not retrieve all necessary elements from DOM.");this.current_player=new e("cross"),this.computer=new t("circle"),this.human=this.current_player,this.state=new s,this.winner=null}setupDOM(){this.restart.addEventListener("click",(()=>{this.restartHook()})),this.board.addEventListener("click",(e=>{this.delegateHook(e)})),this.restart.disabled=!0,this.resetOverlay(),this.resetError();for(let e=0,t=9;e<t;e++){let t=document.createElement("li");t.id=e.toString(),this.board.append(t)}}delegateHook(e){e.target.matches("li")&&this.boardHook(parseInt(e.target.id))}boardHook(e){let t=document.getElementById(e.toString());if(""===t.className&&null===this.winner){this.restart.disabled=!1;try{this.state.addMove(this.current_player,e),this.winner=this.getWinner(),t.className=this.current_player.symbol}catch(e){return void this.showError(e.message)}this.isGameOver()?this.showOverlayByState():this.toggleCurrentPlayer()}}restartHook(){let e=this.board.getElementsByTagName("li");for(let t=0,r=e.length;t<r;t++)e[t].className="";this.restart.disabled=!0,this.current_player=this.human,this.state=new s,this.winner=null,this.resetOverlay(),this.resetError()}toggleCurrentPlayer(){this.current_player.symbol===this.human.symbol?this.current_player=this.computer:this.current_player=this.human}getWinner(){switch(this.state.getWinner()){case this.computer.symbol:return this.computer;case this.human.symbol:return this.human;default:return null}}isGameOver(){return null!==this.state.getWinner()||!this.state.board.includes(null)}showOverlayByState(){null!==this.winner?(this.winner.symbol===this.computer.symbol&&this.showOverlay(c.loose,d),this.winner.symbol===this.human.symbol&&this.showOverlay(c.win,m)):this.showOverlay(c.tie)}showOverlay(e,t=null){this.message.innerHTML=e,this.overlay.className=null!==t?`${u} ${t}`:`${u}`}resetOverlay(){this.overlay.className=h,this.message.innerHTML=""}showError(e){this.error.className=`${d} ${u}`,this.error.innerHTML=e,setTimeout(this.resetError,2e3)}resetError(){this.error.className=h,this.error.innerHTML=""}}window.onload=function(){(new y).setupDOM()};
