class e{symbol;constructor(e){this.symbol=e}get symbol(){return this.symbol}}class t extends e{getMove(e){return 7}}const s=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];class r{board;constructor(){this.board=this.getBlank()}get board(){return this.board}addMove(e,t){this.abortInvalidMove(t),this.board[t]=e.symbol}getWinner(){for(let e=0,t=s.length;e<t;e++){let t=s[e];if(null!==this.board[t[0]]&&this.board[t[0]]===this.board[t[1]]&&this.board[t[0]]===this.board[t[2]])return this.board[t[0]]}return null}abortInvalidMove(e){if(0>e||e>8)throw new Error("Index is not between 0 and 8.");if(null!==this.board[e])throw new Error("This field is already taken.")}getBlank(){let e=[];for(let t=0,s=9;t<s;t++)e[t]=null;return e}}const n="game-message",i="game-restart",a="game-board",o="invisible",l="visible",h="success",u="failure",m="common",d={computer_won:"I'm sorry, you've lost!",human_won:"Congratulations! You've managed to cheat somehow!",tie:"Congratulations, a tie ain't bad!"};class c{message;restart;board;current_player;computer;human;winner;state;constructor(){if(this.message=document.getElementById(n),this.restart=document.getElementById(i),this.board=document.getElementById(a),null===this.message||null===this.restart||null===this.board)throw new Error("Could not retrieve all necessary elements from DOM.");this.current_player=new e("cross"),this.computer=new t("circle"),this.human=this.current_player,this.winner=null,this.state=new r}setupDOM(){this.restart.addEventListener("click",(()=>{this.restartHook()})),this.board.addEventListener("click",(e=>{this.delegateHook(e)})),this.restart.disabled=!0,this.message.className=o,this.message.innerHTML="";for(let e=0,t=9;e<t;e++){let t=document.createElement("li");t.id=e.toString(),this.board.append(t)}}delegateHook(e){e.target.matches("li")&&this.boardHook(parseInt(e.target.id))}boardHook(e){this.restart.disabled=!1;let t=document.getElementById(e.toString());if(""===t.className&&null===this.winner){try{this.state.addMove(this.current_player,e),this.winner=this.getWinner(),t.className=this.current_player.symbol}catch(e){return void this.showMessage(e.message,u)}if(this.isGameOver())return null!==this.winner&&this.winner.symbol===this.computer.symbol&&this.showMessage(d.computer_won,u,!1),null!==this.winner&&this.winner.symbol===this.human.symbol&&this.showMessage(d.human_won,h,!1),void(null===this.winner&&this.showMessage(d.tie,m,!1));this.toggleCurrentPlayer()}}restartHook(){let e=this.board.getElementsByTagName("li");for(let t=0,s=e.length;t<s;t++)e[t].className="";this.restart.disabled=!0,this.current_player=this.human,this.winner=null,this.state=new r,this.resetMessage()}showMessage(e,t,s=!1){this.message.innerHTML=e,this.message.className=`${t} ${l}`,s&&setTimeout(this.resetMessage,2e3)}toggleCurrentPlayer(){this.current_player.symbol===this.human.symbol?this.current_player=this.computer:this.current_player=this.human}isGameOver(){return null!==this.state.getWinner()||!this.state.board.includes(null)}resetMessage(){this.message.className=o,this.message.innerHTML=""}getWinner(){switch(this.state.getWinner()){case this.computer.symbol:return this.computer;case this.human.symbol:return this.human;default:return null}}}window.onload=function(){(new c).setupDOM()};
