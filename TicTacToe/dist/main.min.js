class e{symbol;constructor(e){this.symbol=e}get symbol(){return this.symbol}}const t=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];class r{board;constructor(e=null){this.board=e??this.getBlank()}get board(){return this.board}addMove(e,t){this.abortInvalidMove(t),this.board[t]=e.symbol}getWinner(){for(let e=0,r=t.length;e<r;e++){let r=t[e];if(null!==this.board[r[0]]&&this.board[r[0]]===this.board[r[1]]&&this.board[r[0]]===this.board[r[2]])return this.board[r[0]]}return null}abortInvalidMove(e){if(!this.isIndexWithinRange(e))throw new Error("Index is not between 0 and 8.");if(!this.isIndexAvailable(e))throw new Error("This field is already taken.")}isIndexAvailable(e){return!!this.isIndexWithinRange(e)&&null===this.board[e]}isIndexWithinRange(e){return 0<=e&&e<=8}getBlank(){let e=[];for(let t=0,r=9;t<r;t++)e[t]=null;return e}}class s extends e{opponent;constructor(e,t){super(t),this.opponent=e}getMove(e){let t=this.getPossibleMoves(e),s=[];for(let i=0,n=t.length;i<n;i++){let n=new r([...e]),l=t[i];n.addMove(this,l),s[l]=this.getScore(this,n)}let i=null;for(let e in s)(null===i||s[e]>0)&&(i=e);return null!==i?parseInt(i):null}getScore(e,t){switch(t.getWinner()){case this.opponent.symbol:return-10;case this.symbol:return 10;default:return 0}}getPossibleMoves(e){let t=[];for(let r=0,s=9;r<s;r++)null===e[r]&&t.push(r);return t}}const i="game-restart",n="game-overlay",l="game-message",o="game-error",a="game-board",h="invisible",u="visible",d="success",m="failure",c={win:"You've won!",loose:"You've lost!",tie:"It's a tie!"};class y{restart;overlay;message;error;board;current_player;winner;computer;human;state;constructor(){if(this.overlay=document.getElementById(n),this.restart=document.getElementById(i),this.message=document.getElementById(l),this.error=document.getElementById(o),this.board=document.getElementById(a),null===this.error||null===this.restart||null===this.board||null===this.overlay||null===this.message)throw new Error("Could not retrieve all necessary elements from DOM.");this.current_player=new e("cross"),this.computer=new s(this.current_player,"circle"),this.human=this.current_player,this.state=new r,this.winner=null}setupDOM(){this.restart.addEventListener("click",(()=>{this.restartHook()})),this.board.addEventListener("click",(e=>{this.delegateHook(e)})),this.restart.disabled=!0,this.resetOverlay(),this.resetError();for(let e=0,t=9;e<t;e++){let t=document.createElement("li");t.id=e.toString(),this.board.append(t)}}delegateHook(e){e.target.matches("li")&&this.boardHook(parseInt(e.target.id))}boardHook(e){if(!this.isGameOver()&&this.state.isIndexAvailable(e)&&(this.restart.disabled=!1,this.processMove(this.current_player,e),!this.isGameOver())){let e=this.computer.getMove([...this.state.board]);null!==e&&this.processMove(this.computer,e)}}processMove(e,t){try{this.state.addMove(e,t),this.winner=this.getWinner(),this.toggleCurrentPlayer()}catch(e){return void this.showError(e.message)}document.getElementById(t.toString()).className=e.symbol,this.isGameOver()&&this.showOverlayByState()}restartHook(){let e=this.board.getElementsByTagName("li");for(let t=0,r=e.length;t<r;t++)e[t].className="";this.restart.disabled=!0,this.current_player=this.human,this.state=new r,this.winner=null,this.resetOverlay(),this.resetError()}toggleCurrentPlayer(){this.current_player.symbol===this.human.symbol?this.current_player=this.computer:this.current_player=this.human}getWinner(){switch(this.state.getWinner()){case this.computer.symbol:return this.computer;case this.human.symbol:return this.human;default:return null}}isGameOver(){return null!==this.state.getWinner()||!this.state.board.includes(null)}showOverlayByState(){null!==this.winner?(this.winner.symbol===this.computer.symbol&&this.showOverlay(c.loose,m),this.winner.symbol===this.human.symbol&&this.showOverlay(c.win,d)):this.showOverlay(c.tie)}showOverlay(e,t=null){this.message.innerHTML=e,this.overlay.className=null!==t?`${u} ${t}`:`${u}`}resetOverlay(){this.overlay.className=h,this.message.innerHTML=""}showError(e){this.error.className=`${m} ${u}`,this.error.innerHTML=e,setTimeout(this.resetError,2e3)}resetError(){this.error.className=h,this.error.innerHTML=""}}window.onload=function(){(new y).setupDOM()};
